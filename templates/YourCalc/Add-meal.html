{% extends 'YourCalc/base.html' %} {% block content %} {% load static %}
<head><style>
  form {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 50%;
    margin: 20px auto;
  }

  .ingredient {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }

  select,
  input[type="number"] {
    width: 60px;
    height: 30px;
    margin-right: 10px;
  }

  button[type="button"] {
    background-color: lightgray;
    border: none;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
  }

  button[type="submit"] {
    background-color: green;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 20px;
  }
</style></head>
{#   <div class="site-section">#}
{##}
{#            <div class="col-md-12 text-center">#}
{#              <h2 class="site-section-heading text-center font-secondary">Poniedziałek</h2>#}
{#            </div>#}
{##}
{#              <div class="owl-carousel-2 owl-carousel">#}
{#                <div class="d-block block-testimony mx-auto text-center">#}
{#                  <div class="person w-25 mx-auto mb-4">#}
{##}
{#                  </div>#}
{#                  <div>#}
{#                    <table border="3" cellpadding="10" cellspacing="0">#}
{#                        <thead>#}
{#                          <colgroup>#}
{#                            <col width="60%" />#}
{#                            <col width="20%" />#}
{#                            <col width="20%" span="1" style="background-color:#f1f1f1;" />#}
{#                          </colgroup>#}
{#                          <tr>#}
{#                            <th align="left" class="col-item-name">Posiłki</th>#}
{#                            <th align="center" class="col-quantity">Ilość</th>#}
{#                            <th align="center" class="col-kcal">Kcal</th>#}
{#                          </tr>#}
{#                        </thead>#}
{#                        <tbody>#}
{#                          <tr>#}
{#                            <td>Potatoes</td>#}
{#                            <td align="center">{{ingredients.quantity}}</td>#}
{#                            <td align="center">$1.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Nuts</td>#}
{#                            <td align="center">20</td>#}
{#                            <td align="center">$5</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Onions</td>#}
{#                            <td align="center">4</td>#}
{#                            <td align="center">$3.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td charoff="1">#}
{#                              Very long awkwardly named yet still delicious item here#}
{#                            </td>#}
{#                            <td align="center">4</td>#}
{#                            <td align="center">$3.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Carrots</td>#}
{#                            <td align="center">12</td>#}
{#                            <td align="center">$2.99</td>#}
{#                          </tr>#}
{#                        </tbody>#}
{#                        <tfoot>#}
{#                          <td class="kcal_txt" scope="col" colspan="3">Suma:</td>#}
{#                        </tfoot>#}
{#                      </table>                  </div>#}
{#                </div>#}
{#                <div class="d-block block-testimony mx-auto text-center">#}
{#                  <div class="person w-25 mx-auto mb-4">#}
{#                  </div>#}
{##}
{#                  <div>#}
{#                    <table border="3" cellpadding="10" cellspacing="0">#}
{#                        <thead>#}
{#                          <colgroup>#}
{#                            <col width="60%" />#}
{#                            <col width="20%" />#}
{#                            <col width="20%" span="1" style="background-color:#f1f1f1;" />#}
{#                          </colgroup>#}
{#                          <tr>#}
{#                            <th align="left" class="col-item-name">Posiłki</th>#}
{#                            <th align="center" class="col-quantity">Ilość</th>#}
{#                            <th align="center" class="col-kcal">Kcal</th>#}
{#                          </tr>#}
{#                        </thead>#}
{#                        <tbody>#}
{#                          <tr>#}
{#                            <td>Potatoes</td>#}
{#                            <td align="center">51</td>#}
{#                            <td align="center">$1.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Nuts</td>#}
{#                            <td align="center">20</td>#}
{#                            <td align="center">$5</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Onions</td>#}
{#                            <td align="center">4</td>#}
{#                            <td align="center">$3.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td charoff="1">#}
{#                              Very long awkwardly named yet still delicious item here#}
{#                            </td>#}
{#                            <td align="center">4</td>#}
{#                            <td align="center">$3.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Carrots</td>#}
{#                            <td align="center">12</td>#}
{#                            <td align="center">$2.99</td>#}
{#                          </tr>#}
{#                        </tbody>#}
{#                        <tfoot>#}
{#                          <td class="kcal_txt" scope="col" colspan="3">Total Kcal</td>#}
{#                        </tfoot>#}
{#                      </table>                  </div>#}
{#                </div>#}
{##}
{#                <div class="d-block block-testimony mx-auto text-center">#}
{#                  <div class="person w-25 mx-auto mb-4">#}
{##}
{#                  </div>#}
{#                  <div>#}
{##}
{#                    <table border="3" cellpadding="10" cellspacing="0">#}
{#                        <thead>#}
{#                          <colgroup>#}
{#                            <col width="60%" />#}
{#                            <col width="20%" />#}
{#                            <col width="20%" span="1" style="background-color:#f1f1f1;" />#}
{#                          </colgroup>#}
{#                          <tr>#}
{#                            <th align="left" class="col-item-name">Posiłki</th>#}
{#                            <th align="center" class="col-quantity">Ilość</th>#}
{#                            <th align="center" class="col-kcal">Kcal</th>#}
{#                          </tr>#}
{#                        </thead>#}
{#                        <tbody>#}
{#                          <tr>#}
{#                            <td>Potatoes</td>#}
{#                            <td align="center">51</td>#}
{#                            <td align="center">$1.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Nuts</td>#}
{#                            <td align="center">20</td>#}
{#                            <td align="center">$5</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Onions</td>#}
{#                            <td align="center">4</td>#}
{#                            <td align="center">$3.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td charoff="1">#}
{#                              Very long awkwardly named yet still delicious item here#}
{#                            </td>#}
{#                            <td align="center">4</td>#}
{#                            <td align="center">$3.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Carrots</td>#}
{#                            <td align="center">12</td>#}
{#                            <td align="center">$2.99</td>#}
{#                          </tr>#}
{#                        </tbody>#}
{#                        <tfoot>#}
{#                          <td class="kcal_txt" scope="col" colspan="3">Suma:</td>#}
{#                        </tfoot>#}
{#                      </table>                  </div>#}
{#                </div>#}
{##}
{#                <div class="d-block block-testimony mx-auto text-center">#}
{#                  <div class="person w-25 mx-auto mb-4">#}
{##}
{#                  </div>#}
{#                  <div>#}
{##}
{#                    <table border="3" cellpadding="10" cellspacing="0">#}
{#                        <thead>#}
{#                          <colgroup>#}
{#                            <col width="60%" />#}
{#                            <col width="20%" />#}
{#                            <col width="20%" span="1" style="background-color:#f1f1f1;" />#}
{#                          </colgroup>#}
{#                          <tr>#}
{#                            <th align="left" class="col-item-name">Posiłki</th>#}
{#                            <th align="center" class="col-quantity">Ilość</th>#}
{#                            <th align="center" class="col-kcal">Kcal</th>#}
{#                          </tr>#}
{#                        </thead>#}
{#                        <tbody>#}
{#                          <tr>#}
{#                            <td>Potatoes</td>#}
{#                            <td align="center">51</td>#}
{#                            <td align="center">$1.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Nuts</td>#}
{#                            <td align="center">20</td>#}
{#                            <td align="center">$5</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Onions</td>#}
{#                            <td align="center">4</td>#}
{#                            <td align="center">$3.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td charoff="1">#}
{#                              Very long awkwardly named yet still delicious item here#}
{#                            </td>#}
{#                            <td align="center">4</td>#}
{#                            <td align="center">$3.00</td>#}
{#                          </tr>#}
{#                          <tr>#}
{#                            <td>Carrots</td>#}
{#                            <td align="center">12</td>#}
{#                            <td align="center">$2.99</td>#}
{#                          </tr>#}
{#                        </tbody>#}
{#                        <tfoot>#}
{#                          <td class="kcal_txt" scope="col" colspan="3">Suma:</td>#}
{#                        </tfoot>#}
{#                      </table>#}

<center>
<form id="meal-form" action="/add-meal/" method="post">
  {{ form }}
  {% csrf_token %}
  <div id="ingredient-fields">
  </div>
  <button type="button" id="add-ingredient-button">Add Ingredient</button>
  <button type="submit">Save Meal</button>

<script>
    const form = document.getElementById("meal-form");
    const ingredientFields = document.getElementById("ingredient-fields");
    const addIngredientButton = document.getElementById("add-ingredient-button");

    const addIngredient = () => {
        const ingredientSelect = document.createElement("select");
        ingredientSelect.name = "ingredient";
        const quantityInput = document.createElement("input");
        quantityInput.name = "quantity";
        quantityInput.type = "text";

        fetch("/view-ingredients/")
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            const ingredients = data.ingredients;
            for (let i = 0; i < ingredients.length; i++) {
              const option = document.createElement("option");
              option.value = ingredients[i].id;
              option.text = ingredients[i].name;
              ingredientSelect.add(option);
            }
            ingredientFields.innerHTML += `${ingredientSelect.outerHTML} ${quantityInput.outerHTML}`;
          })
          .catch((error) => {
            console.error(error);
          });
    };

    addIngredientButton.addEventListener("click", addIngredient);

    ingredientFields.addEventListener("click", (event) => {
      if (event.target.className === "remove-ingredient-button") {
        event.target.parentElement.remove();
      }
    });

form.addEventListener("submit", (event) => {
    event.preventDefault();
    const ingredients = [];
    const quantityInputs = document.querySelectorAll('input[name="quantity"]');
    const ingredientSelects = document.querySelectorAll('select[name="ingredient"]');

    for (let i = 0; i < ingredientSelects.length; i++) {
        const ingredient = ingredientSelects[i].value;
        const quantity = quantityInputs[i].value;
        ingredients.push({ingredient, quantity});
    }

    const csrfToken = document.getElementsByName("csrfmiddlewaretoken")[0].value;

fetch("/add-meal/", {
    method: "POST",
    headers: {
        "Content-Type": "application/json;charset=utf-8",
        "X-CSRFToken": csrfToken,
    },
    body: JSON.stringify({ingredients}),
})
    .then((response) => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then((data) => {
        console.log(data);
    })
    .catch((error) => {
        console.error(error);
    });
})

  </script>
</form>
</center>
{% endblock %}